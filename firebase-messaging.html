<link rel="import" href="../polymer/polymer.html">

<script>
  Polymer({
    is: 'firebase-messaging',

    properties: {
      token: {
        type: String,
        value: null,
        notify: true,
        readOnly: true,
      },

      lastMessage: {
        type: Object,
        value: null,
        notify: true,
        readOnly: true,
      }
    },

    attached: function() {
      window.FirebasePlugin.onTokenRefresh(function(token) {
        this._setToken(token);
      }.bind(this), function(error) {
        this.fire('error', error);
      }.bind(this));

      window.FirebasePlugin.onNotificationOpen(function(notification) {
        this._setLastMessage(notification);
        this.fire('message', {
          message: notification
        });
      }.bind(this), function(error) {
        this.fire('error', error);
      }.bind(this));
    }
  });
</script>
